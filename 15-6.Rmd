---
title: "15-6"
author: "Andrew Wu"
date: "2025-08-08"
output: html_document
---

Estimate the correlation between temperature and latitude using the data from https://lib.stat.cmu.edu/DASL/Datafiles/USTemperatures.html.

Use the correlation coefficient. Provide estimates, tests, and confidence intervals.

```{r}
url <- "https://lib.stat.cmu.edu/DASL/Datafiles/USTemperatures.html"
destfile <- "USTemperatures.dat"
download.file(url,destfile)
```

```{r}
raw_data <- readLines(destfile)
raw_data
```

First, we'll get rid of all extraneous rows.

```{r}
raw_data_removed_rows <- raw_data[c(31:87)]
raw_data_removed_rows
```

Let's throw everything into a table.

```{r}
writeLines(raw_data_removed_rows,"cleaned_USTemperatures.dat")
USTemperatures <- read.table("cleaned_USTemperatures.dat",sep="\t",header=TRUE)
USTemperatures
```

We want to estimate the correlation between temperature and latitutde, so let's drop the last column.

```{r}
USTemperaturesTempLat <- USTemperatures[,c(1:3)]
head(USTemperaturesTempLat)
```

Now we'll get the sample correlation, which is an estimate of the correlation.

```{r}
temps <- USTemperaturesTempLat$JanTemp
lats <- USTemperaturesTempLat$Lat

rho_hat <- cor(temps,lats)
print(rho_hat)
```

We'll use the Fisher method to get a confidence interval.

```{r}
# write a function to get a fisher CI from a correlation estimate
# rho_hat is the estimated correlation, n is the number of datapoints, we'll get a 1-alpha CI
get_cor_CI <- function(rho_hat,n,alpha) {
  
  # compute theta_hat
  theta_hat <- 0.5*(log(1 + rho_hat) - log(1 - rho_hat))
  
  # get approximate SE of theta_hat
  se_theta_hat <- 1/sqrt(n-3)
  
  # get 1-alpha CI for theta
  z_alpha2 <- qnorm(1 - alpha/2)
  a <- theta_hat - z_alpha2*se_theta_hat
  b <- theta_hat + z_alpha2*se_theta_hat
  
  # apply inverse transform
  rho_hat_ci <- c((exp(2*a) - 1)/(exp(2*a) + 1), (exp(2*b) - 1)/(exp(2*b) + 1))
  return(rho_hat_ci)
}
```

```{r}
n <- length(temps)
alpha <- 0.05
get_cor_CI(rho_hat,n,alpha)
```













